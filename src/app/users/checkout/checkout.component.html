<div class="checkout-container">
  <div class="checkout-header">
    <h1>Checkout</h1>
    <p>Please fill in the details below to complete your order.</p>
  </div>

  <!-- Progress Stepper -->
  <div class="stepper">
    <div
      class="step"
      [class.active]="currentStep >= 1"
      [class.completed]="currentStep > 1"
    >
      <div class="step-icon">1</div>
      <div class="step-label">Shipping</div>
    </div>
    <div class="step-connector"></div>
    <div
      class="step"
      [class.active]="currentStep >= 2"
      [class.completed]="currentStep > 2"
    >
      <div class="step-icon">2</div>
      <div class="step-label">Payment</div>
    </div>
    <div class="step-connector"></div>
    <div class="step" [class.active]="currentStep >= 3">
      <div class="step-icon">3</div>
      <div class="step-label">Review</div>
    </div>
  </div>

  <div class="row">
    <!-- Left Column: Form -->
    <div class="col-lg-7">
      <form [formGroup]="checkoutForm">
        <!-- Step 1: Shipping Details -->
        <div class="form-step" *ngIf="currentStep === 1">
          <h3>Shipping Address</h3>

          <!-- Full Name -->
          <div class="form-group">
            <label for="name">Full Name</label>
            <input
              type="text"
              id="name"
              class="form-control"
              formControlName="name"
            />
            <!-- âœ… CORRECTION: Use bracket notation f['name'] instead of f.name -->
            <div
              *ngIf="
                f['name'].invalid && (f['name'].dirty || f['name'].touched)
              "
              class="validation-error"
            >
              <div *ngIf="f['name'].errors?.['required']">
                Full Name is required.
              </div>
            </div>
          </div>

          <!-- Email Address -->
          <div class="form-group">
            <label for="email">Email Address</label>
            <input
              type="email"
              id="email"
              class="form-control"
              formControlName="email"
            />
            <div
              *ngIf="
                f['email'].invalid && (f['email'].dirty || f['email'].touched)
              "
              class="validation-error"
            >
              <div *ngIf="f['email'].errors?.['required']">
                Email is required.
              </div>
              <div *ngIf="f['email'].errors?.['email']">
                Please enter a valid email address.
              </div>
            </div>
          </div>

          <!-- Phone Number -->
          <div class="form-group">
            <label for="phone">Phone Number</label>
            <input
              type="tel"
              id="phone"
              class="form-control"
              formControlName="phone"
            />
            <div
              *ngIf="
                f['phone'].invalid && (f['phone'].dirty || f['phone'].touched)
              "
              class="validation-error"
            >
              <div *ngIf="f['phone'].errors?.['required']">
                Phone number is required.
              </div>
              <div *ngIf="f['phone'].errors?.['pattern']">
                Please enter a valid phone number.
              </div>
            </div>
          </div>

          <!-- Street Address -->
          <div class="form-group">
            <label for="streetAddress">Street Address</label>
            <input
              type="text"
              id="streetAddress"
              class="form-control"
              formControlName="streetAddress"
            />
            <div
              *ngIf="
                f['streetAddress'].invalid &&
                (f['streetAddress'].dirty || f['streetAddress'].touched)
              "
              class="validation-error"
            >
              <div *ngIf="f['streetAddress'].errors?.['required']">
                Street address is required.
              </div>
            </div>
          </div>

          <div class="form-row">
            <!-- Town / City -->
            <div class="form-group">
              <label for="townCity">Town / City</label>
              <input
                type="text"
                id="townCity"
                class="form-control"
                formControlName="townCity"
              />
              <div
                *ngIf="
                  f['townCity'].invalid &&
                  (f['townCity'].dirty || f['townCity'].touched)
                "
                class="validation-error"
              >
                <div *ngIf="f['townCity'].errors?.['required']">
                  City is required.
                </div>
              </div>
            </div>
            <!-- Zip Code -->
            <div class="form-group">
              <label for="zipCode">Zip Code</label>
              <input
                type="text"
                id="zipCode"
                class="form-control"
                formControlName="zipCode"
              />
              <div
                *ngIf="
                  f['zipCode'].invalid &&
                  (f['zipCode'].dirty || f['zipCode'].touched)
                "
                class="validation-error"
              >
                <div *ngIf="f['zipCode'].errors?.['required']">
                  Zip code is required.
                </div>
              </div>
            </div>
          </div>

          <button type="button" class="btn-primary" (click)="nextStep()">
            Continue to Payment
          </button>
        </div>

        <!-- Step 2: Payment -->
        <div class="form-step" *ngIf="currentStep === 2">
          <h3>Payment Method</h3>
          <!-- Payment options here -->
          <div class="payment-options">
            <label class="payment-option">
              <input type="radio" value="COD" formControlName="paymentMethod" />
              <span>Cash on Delivery</span>
            </label>
            <label class="payment-option">
              <input
                type="radio"
                value="CreditCard"
                formControlName="paymentMethod"
              />
              <span>Credit Card</span>
            </label>
          </div>
          <div class="step-navigation">
            <button type="button" class="btn-secondary" (click)="prevStep()">
              Back
            </button>
            <button type="button" class="btn-primary" (click)="nextStep()">
              Review Order
            </button>
          </div>
        </div>

        <!-- Step 3: Review -->
        <div class="form-step" *ngIf="currentStep === 3">
          <h3>Review Your Order</h3>
          <!-- Review details here -->
          <div class="review-details">
            <p><strong>Name:</strong> {{ checkoutForm.value.name }}</p>
            <p><strong>Email:</strong> {{ checkoutForm.value.email }}</p>
            <p>
              <strong>Address:</strong> {{ checkoutForm.value.streetAddress }},
              {{ checkoutForm.value.townCity }}
            </p>
          </div>
          <div class="step-navigation">
            <button type="button" class="btn-secondary" (click)="prevStep()">
              Back
            </button>
            <button type="button" class="btn-success" (click)="placeOrder()">
              Place Order & Pay
            </button>
          </div>
        </div>
      </form>
    </div>

    <!-- Right Column: Order Summary -->
    <div class="col-lg-5">
      <div class="order-summary">
        <h4>Order Summary</h4>
        <div class="summary-item" *ngFor="let item of orderSummaryItems">
          <span class="item-name">{{ item.name }} (x{{ item.quantity }})</span>
          <span class="item-price">{{
            item.price * item.quantity | currency : "USD"
          }}</span>
        </div>
        <hr />
        <div class="summary-total">
          <strong>Total</strong>
          <strong>{{ getTotal() | currency : "USD" }}</strong>
        </div>
      </div>
    </div>
  </div>
</div>
